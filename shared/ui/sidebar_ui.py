import streamlit as st
from typing import Optional

def show_sidebar(auth, user_role: str, name: Optional[str]):
    # –±–∞–∑–æ–≤—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å)
    tool_actions = {
        "–ü—Ä–æ–≤–µ—Ä–∫–∞ JSON": "run_json_tool",
        "–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä JSON ‚áÑ XML": "run_converter",
        "–°–æ–∑–¥–∞–Ω–∏–µ JSON –ø–æ —Å—Ö–µ–º–µ": "run_json_generator"
    }

    # –æ–ø–∏—Å–∞–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥ –≤—ã–±–æ—Ä–æ–º)
    descriptions = {
        "–ü—Ä–æ–≤–µ—Ä–∫–∞ JSON": "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ø—É—Ç—å –¥–æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —É–∑–ª–∞.",
        "–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä JSON ‚áÑ XML": "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ–∂–¥—É JSON –∏ XML.",
        "–°–æ–∑–¥–∞–Ω–∏–µ JSON –ø–æ —Å—Ö–µ–º–µ": "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–º–µ—Ä JSON –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π JSON-Schema."
    }

    # —Å–æ–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏–∏ (–ø–æ—Ä—è–¥–æ–∫ - –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)
    options = list(tool_actions.keys())
    if user_role == "admin":
        options += ["–†–∞–±–æ—Ç–∞ —Å –ë–î", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"]
    options.append("–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã")

    db_action = None
    generator_action = None

    # –Ω–µ–±–æ–ª—å—à–∏–µ —Å—Ç–∏–ª–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –Ω–æ —É–ª—É—á—à–∞—é—Ç –≤–∏–¥)
    st.markdown(
        """
        <style>
        .sidebar .stMarkdown { padding-top: 0.2rem; }
        .user-role { color: #6c757d; font-size:12px; margin-top:-6px; }
        </style>
        """,
        unsafe_allow_html=True,
    )

    with st.sidebar:
        # —à–∞–ø–∫–∞ –ø–∞–Ω–µ–ª–∏
        st.markdown("## üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã")
        # –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ + —Ç–µ–∫—Å—Ç–∞
        c1, c2 = st.columns([1, 4])
        with c1:
            # –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ st.image(avatar) –µ—Å–ª–∏ –µ—Å—Ç—å
            st.markdown("üßë‚Äçüíª", unsafe_allow_html=True)
        with c2:
            if name:
                st.markdown(f"**–ü—Ä–∏–≤–µ—Ç, {name}!**")
            st.markdown(f"<div class='user-role'>–†–æ–ª—å: {user_role}</div>", unsafe_allow_html=True)
            # –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            if st.button("–í—ã–π—Ç–∏", key="logout_btn"):
                auth.logout()

        st.markdown("---")

        # –≥–ª–∞–≤–Ω—ã–π –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        choice = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:", options, index=0, help="–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã", key="sidebar_choice")

        # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –æ–ø—Ü–∏—è ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º expander —Å –æ–ø—Ü–∏—è–º–∏ (–¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)
        if choice == "–†–∞–±–æ—Ç–∞ —Å –ë–î":
            with st.expander("–†–∞–±–æ—Ç–∞ —Å –ë–î ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è", expanded=True):
                db_action = st.radio("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", ["–ü—Ä–æ—Å–º–æ—Ç—Ä"], key="db_action")
        elif choice == "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏":
            with st.expander("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏", expanded=False):
                st.write("–ó–¥–µ—Å—å –±—É–¥—É—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏.")
        elif choice == "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã":
            st.markdown("**–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã**")
            generator_action = st.radio(
                "–í—ã–±–µ—Ä–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä:",
                ["–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JSON-Schema", "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤", "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JSON"],
                index=0,
                key="generator_action"
            )
        else:
            # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            desc = descriptions.get(choice)
            if desc:
                st.info(desc)

        st.markdown("---")
        # –ø–æ–¥—Å–∫–∞–∑–∫–∏/—Å—Ç–∞—Ç—É—Å—ã
        st.caption("–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.")

    return choice, db_action, generator_action
